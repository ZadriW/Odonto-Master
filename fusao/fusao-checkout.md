

<FBITS:Cabecalho />

<style>
.fbits-responsive-carrinho-item-atributos {
    display: none!important;
}
.fbits-frete-retirada-popup > div {
    top: 0!important;
    margin-top: 0!important;
    max-height: 100vw!important;
    overflow-y: scroll;
}
.fbits-carrinho-frete-item .fbits-frete-retirada-endereco {
    color: #000;
}
.fbits-responsive-carrinho-item-quantidade .input-group {
    max-width: 52px;
}
.fbits-carrinho-frete-item .fbits-frete-retirada-mais {
    color: #000!important;
}
.fbits-carrinho-frete-item .fbits-frete-retirada-endereco {
    color: #000!important;
}
input.form-control.input-number.qtdCarrinho {
    pointer-events: none!important;
}

.fbits-frete-retirada-texto {
    padding-left: 1em;
    padding-right: 1em;
}

    span.fbits-parcela-juros {
        display: none;
    }
    .fbits-responsive-carrinho-item-atributos {
        max-width: 390px;
        font-size: 0.9em;
        margin-top: 0.4em;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade {
        color: #000;
        position: absolute;
        top: 9.6em;
        left: 189px;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade:before {
        content: "QTD:";
        display: inline;
        position: absolute;
        left: -2em;
        font-size: 0.9em;
        line-height: 2.9em;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade button.btn.btn-default.btn-number {
        border: 0!important;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade .input-group {
        border: 2px solid #ccc;
        border-radius: 6px;
    }
    a.arrow:before {
        font-family: fontAwesome;
        color: #5f5f5f;
        margin: 0 auto;
        font-size: 0.8em;
        content: "\f068";
    }
    .qtdCarrinho {
        min-width: 2.4em;
        text-align: center;
        border: 0;
        margin: 0;
        padding-left: 2px;
        padding-right: 2px;
        height: auto;
        border-right: 1px solid #ddd;
        border-left: 1px solid #ddd;
    }

    button.btn.btn-default.btn-number {
        border: 0!important;
        margin-left: 1px;
        box-shadow: none!important;
        border-radius: 7px;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-valor-unitario .currency:before {
        content: "Valor unitário: R$ ";
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-valor-unitario {
        position: absolute;
        right: 0;
        width: 18em;
        bottom: 4em;
        color: #000;
        font-size: 1em;
        padding: 0;
        padding-right: 0.6em;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-right.fbits-responsive-carrinho-item-total {
        position: absolute;
        right: 0;
        width: 18em;
        bottom: 1em;
        color: #000;
        font-size: 1em;
        padding: 0;
        padding-right: 0.6em;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-right.fbits-responsive-carrinho-item-total > .text-nowrap > .currency {
        font-weight: bold;
        font-size: 1.1em;
    }
    .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-right.fbits-responsive-carrinho-item-total .text-nowrap:before {
        content: "Valor Total: ";
    }
    
    .hidemob.botoes-desk {
        clear: both;
        margin: 0;
    }
    .hidemob.botoes-desk .container-continuar {
        float: left;
    }
    .botoes-desk a.btn.btn-success.btfinalizar.lastb {
        float: right;
    }
    span.text-left.col-lg-6.col-md-6.col-sm-6.col-xs-6.fbits-responsive-carrinho-subtotal-header{
            font-weight: normal;
    }
    span.text-right.col-lg-6.col-md-6.col-sm-6.col-xs-6.fbits-responsive-carrinho-subtotal-valor {
        font-weight: normal;
    }
    p.has-error.mensagem {
        background: #febdc1;
        text-align: center;
        color: #fff;
        text-transform: uppercase;
        font-size: 0.8em;
        padding: 4px;
        font-weight: bold;
    }
    div#mensagemAlerta {
        position: relative;
        max-width: 89%;
        margin: 0 auto;
        margin-bottom: 2em;
    }
    span#fecharMensagemAlerta {
        position: absolute;
        top: -1.9em;
        right: 0;
        width: 1em;
        color: transparent;
    }
      span#fecharMensagemAlerta:before {
        font-family: fontAwesome;
        font-size: 1.5em;
        position: absolute;
        top: 0;
        color: red;
        content: "\f00d"!important;
    }
    a.btn.btn-danger.icon.remover:before {
        font-family: fontAwesome;
        font-size: 1.5em;
        color: #696969;
        position: absolute;
        top: 0.5em;
        right: 2.3em;
        content: "\f00d"!important;
    }
    a.btn.btn-danger.icon.remover:after {
        content: "Remover";
        color: #333;
        font-size: 0.8em;
        display: inline;
        position: absolute;
        right: 0;
        top: 1.7em;
    }
    span.text-nowrap.fbits-parcela:before{
        display:none!important;
    }
@@media (min-width:1024px){
    .col-lg-6.col-md-6.col-sm-12.col-xs-12.fbits-responsive-carrinho-item-titulo {
        width: 70%;
    }
    .container-finalizar.col-md-4 {
        float: right;     padding-left: 0; padding-right: 0;
    }
}

input.btn.btn-success.btnCalcular {
    background-repeat: no-repeat;
    background-position: center;
    background-size: 1.4em;
}


a.btn.btn-default.btcontinuar:before {
    display:none;
}

.box-default.checkout-active, .box-default.last-active, #div-frete {
    font-size: 0.9rem;
}
.fbits-carrinho-frete-item {
    border: 1px solid #eee;
    clear: both;
    padding-top: 5px;
    max-width: 100%;
    margin: 5px 0px 0;
    border-radius: 4px;
    position: relative;
    padding-bottom: 0.3em;
    font-size: 0.9em;
}
.fbits-carrinho-frete-item.selected {
    background: #00535d;
    color: #fff;
}
.cupom-botao {
    background: transparent !important;
    border: 0 !important;
    
}
.cupom-botao:hover {
    background: transparent !important;
    border: 0 !important;

}
.cupom-botao:active {
    background: transparent !important;
    border: 0 !important;
    
}
.text-left.fbits-responsive-carrinho-desconto-texto {
    display: none;
}
a.btn.btn-primary.cupom-botao {
    color: #000;
    background-color: transparent;
    border-color: transparent;
    font-weight: bold;
    padding-bottom: 0;
    margin-top: 1em;
    padding-left: 0;
}
.fbits-responsive-carrinho-cupom-sucesso {
    color: green;
    clear: both;
    font-size: 0.8em;
}
input.form-control.fbits-carrinho-cupom {
    width: 100%!important;
}

/* Estilos para produtos agrupados */
.fbits-responsive-carrinho-item.agrupado {
    border-left: 4px solid #00b05b;
    background-color: #f8fff8;
}

.fbits-responsive-carrinho-item .qtdCarrinho.atualizado {
    background-color: #e8f5e8;
    border-color: #00b05b;
    font-weight: bold;
}

/* Animação para produtos sendo agrupados */
@keyframes produtoAgrupado {
    0% { background-color: #fff3cd; }
    50% { background-color: #d4edda; }
    100% { background-color: #f8fff8; }
}

.fbits-responsive-carrinho-item.agrupando {
    animation: produtoAgrupado 1s ease-in-out;
}

@@media (max-width:767px){
        .fbits-responsive-carrinho-item-descricao > a {
            height: 4.2em;
            overflow: hidden;
            display: block;
        }
        .form-inline.fbits-responsive-carrinho-desconto-input input.form-control, input.form-control.fbits-carrinho-calcularFrete-cep {
            width: 100%!important;
        }
        .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade {
            margin-top: 2.3em;
        }
        .fbits-responsive-carrinho li.row.fbits-responsive-carrinho-item {
            padding-left: 0.8em;
        }
        .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-quantidade:before {
            left: -1em;
        }
        .fbits-responsive-carrinho-item-descricao {
            width: 80%;
        }
        .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-right.fbits-responsive-carrinho-item-total {
            bottom: -0.5em;
        }
        .fbits-responsive-carrinho .col-lg-2.col-md-2.col-sm-4.col-xs-4.text-center.text-nowrap.fbits-responsive-carrinho-item-valor-unitario {
            bottom: 3.3em;
        }
        .full-container {
            padding-left: 2em;
            padding-right: 2em;
        }
        .fbits-carrinho .btn-success {
            width: 100%;
        }
        .container-finalizar.hidedesk {
            display: none;
        }
        .footer-bottom, .footer-bottom p {
            color: #687176;
            font-size: 0.8em;
            line-height: 1.4em;
        }
}
</style>

<div class="container tyc_container">
   <div class="row">
      <div class="full-container">
          
        
          
         <FBITS:CarrinhoVazio />
         
         <section class="fbits-responsive-carrinho">

            <div class="fbits-responsive-carrinho-items col-lg-8 col-md-8 col-sm-12 col-xs-12">
         
               <div class="container-finalizar hidedesk">
                    <a href="/Fechamento" class="btn btn-success btfinalizar" onclick="$('body').addClass('checkout-loading');">Finalizar Pedido</a>
               </div>
               
               <span class="carttitle">SUA SACOLA DE COMPRAS</span>
               
               <FBITS:Produtos />
               <FBITS:CarrinhoMensagens />
               
               
            </div>

            <div class="fbits-responsive-carrinho-detalhes col-lg-4 col-md-4 col-sm-12 col-xs-12">
                
                <div class="container-finalizar hidemob">
                    <a href="/Fechamento" class="btn btn-success btfinalizar" onclick="$('body').addClass('checkout-loading');">Finalizar Pedido</a>
                </div>
               
               <span class="carttitle hidemob">RESUMO DO PEDIDO</span>
               
               
               <div class="boxwhite">
               
                   @*<FBITS:Cupom />*@
                   
                    <p>
                      <a class="btn btn-primary cupom-botao" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                        > Possui cupom?
                      </a>
                     
                    </p>
                    <div class="collapse" id="collapseExample">
                      <div class="card card-body">
                        <FBITS:Cupom />
                      </div>
                    </div>
    
                   <FBITS:Frete />
                   
                    <div class="fbits-responsive-carrinho-subtotal">
                      <span class="text-left col-lg-6 col-md-6 col-sm-6 col-xs-6 fbits-responsive-carrinho-subtotal-header">SUBTOTAL</span>
                      <span class="text-right col-lg-6 col-md-6 col-sm-6 col-xs-6 fbits-responsive-carrinho-subtotal-valor">
                          <span class="currency"><FBITS:Subtotal /></span>
                      </span>
                   </div>
    
                   <div class="fbits-responsive-carrinho-total">
                      <div class="text-left col-lg-6 col-md-6 col-sm-6 col-xs-6 fbits-responsive-carrinho-total-header">
                         TOTAL
                      </div>
                      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right fbits-responsive-carrinho-total-valor">
                          <span class="currency"><FBITS:Total /></span>
                      </div>
                   </div>
               
               </div>
               
               <span class="hidedesk">
                   
                   <div class="container-finalizar">
                        <a href="/Fechamento" class="btn btn-success btfinalizar lastb" onclick="$('body').addClass('checkout-loading');">Finalizar Pedido</a>
                   </div>
                   
                   <FBITS:Continuar />
                  
               
               </span>

            </div>
            
            <div class="hidemob botoes-desk row">
                <span class="hidemob"><FBITS:Continuar /></span>
                
                <div class="container-finalizar col-md-4">
                    <a href="/Fechamento" class="btn btn-success btfinalizar lastb" onclick="$('body').addClass('checkout-loading');">Finalizar Pedido</a>
                </div>
                <div style="clear: both"></div>
               
                <div data-share-whatsapp="Ei, olha só estes produtos, aproveita!" class="fa-whats">
                    <span class="fa-whatsapp"></span> Compartilhar o Carrinho
                </div>
                
            </div>
         </section>
      </div>
   </div>
</div>

<script>
    $(document).ready(function(){
        // Ocultar parcelas de 1x
        $(".fbits-quantidadeParcelas").each(function(){
            if ($(this).html()=="1"){
                $(this).parent().hide();
            } 
        });
        
        // Função para agrupar produtos duplicados
        function agruparProdutosDuplicados() {
            console.log("🔄 Verificando produtos duplicados...");
            
            // Buscar todos os itens do carrinho
            var itensCarrinho = $('.fbits-responsive-carrinho-item');
            var produtosAgrupados = {};
            var produtosAgrupadosCount = 0;
            
            itensCarrinho.each(function() {
                var item = $(this);
                var nomeProduto = item.find('.fbits-responsive-carrinho-item-descricao a').text().trim();
                var precoUnitario = item.find('.fbits-responsive-carrinho-item-valor-unitario .currency').text().trim();
                
                // Criar chave única baseada no nome e preço
                var chaveProduto = nomeProduto + '_' + precoUnitario;
                
                if (produtosAgrupados[chaveProduto]) {
                    // Produto já existe, somar quantidades
                    var quantidadeAtual = parseInt(produtosAgrupados[chaveProduto].find('.qtdCarrinho').val()) || 1;
                    var quantidadeNovo = parseInt(item.find('.qtdCarrinho').val()) || 1;
                    var quantidadeTotal = quantidadeAtual + quantidadeNovo;
                    
                    // Adicionar classe de animação ao item existente
                    produtosAgrupados[chaveProduto].addClass('agrupando');
                    
                    // Atualizar quantidade do item existente
                    produtosAgrupados[chaveProduto].find('.qtdCarrinho')
                        .val(quantidadeTotal)
                        .addClass('atualizado');
                    
                    // Recalcular total do item existente
                    var precoNumerico = parseFloat(precoUnitario.replace('R$ ', '').replace(',', '.'));
                    var totalCalculado = (precoNumerico * quantidadeTotal).toFixed(2).replace('.', ',');
                    produtosAgrupados[chaveProduto].find('.fbits-responsive-carrinho-item-total .currency').text('R$ ' + totalCalculado);
                    
                    // Adicionar classe de agrupado
                    produtosAgrupados[chaveProduto].addClass('agrupado');
                    
                    // Remover item duplicado com animação
                    item.fadeOut(300, function() {
                        $(this).remove();
                    });
                    
                    produtosAgrupadosCount++;
                    console.log("✅ Produto agrupado:", nomeProduto, "Quantidade total:", quantidadeTotal);
                } else {
                    // Primeira ocorrência do produto
                    produtosAgrupados[chaveProduto] = item;
                }
            });
            
            // Remover classes de animação após um tempo
            setTimeout(function() {
                $('.fbits-responsive-carrinho-item').removeClass('agrupando');
            }, 1000);
            
            // Atualizar contadores e totais após agrupamento
            setTimeout(function() {
                if (typeof window.atualizarCarrinho === 'function') {
                    window.atualizarCarrinho();
                }
                
                if (produtosAgrupadosCount > 0) {
                    console.log("🎯 Agrupamento concluído:", produtosAgrupadosCount, "produtos agrupados");
                    
                    // Mostrar notificação de sucesso
                    if (typeof mostrarNotificacao === 'function') {
                        mostrarNotificacao(produtosAgrupadosCount + " produto(s) agrupado(s) com sucesso!", "success");
                    }
                } else {
                    console.log("ℹ️ Nenhum produto duplicado encontrado");
                }
            }, 500);
        }
        
        // Executar agrupamento após carregamento da página
        setTimeout(agruparProdutosDuplicados, 1000);
        
        // Executar agrupamento quando novos produtos forem adicionados
        $(document).on('cartUpdated', function() {
            setTimeout(agruparProdutosDuplicados, 500);
        });
        
        /*function msgFrete(){
            $(".col-lg-12.col-md-12.col-sm-12.col-xs-12.fbits-responsive-carrinho-frete-calculo + div >span").html("Não temos essa quantidade disponível para esta região momento. Entre em contato conosco para providenciarmos.")
        }
        
        setInterval("msgFrete()",1500);*/
    });
</script>



<FBITS:Rodape />

